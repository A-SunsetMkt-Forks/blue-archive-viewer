(()=>{var e={};e.id=541,e.ids=[541],e.modules={5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},1877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},5319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},1017:e=>{"use strict";e.exports=require("path")},7310:e=>{"use strict";e.exports=require("url")},1287:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>r.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>u,routeModule:()=>h,tree:()=>c});var i=a(7096),s=a(6132),n=a(7284),r=a.n(n),l=a(2564),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);a.d(t,o);let c=["",{children:["wpengine",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,4922)),"D:\\Project\\blue-archive\\app\\wpengine\\page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,4519))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(a.bind(a,5345)),"D:\\Project\\blue-archive\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9291,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(a.bind(a,4519))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],u=["D:\\Project\\blue-archive\\app\\wpengine\\page.tsx"],d="/wpengine/page",p={require:a,loadChunk:()=>Promise.resolve()},h=new i.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/wpengine/page",pathname:"/wpengine",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},8048:(e,t,a)=>{Promise.resolve().then(a.bind(a,9971))},9971:(e,t,a)=>{"use strict";let i;a.r(t),a.d(t,{default:()=>Home});var s,n=a(784),r=a(3363),l=a(3438);let Live2DViewer=class Live2DViewer extends l.b{constructor(e){super(e),this.isIdle=!1,this._scale=1,this.startListener={end:()=>{}},this.talkListener={end:()=>{}},this.listener={end:e=>{},start:e=>{}},this._currentAnimation="",this.talkListener.complete=this.onTalkComplete.bind(this),this.startListener.complete=this.onStartComplete.bind(this)}onStartComplete(e){this.char&&(this.playAnimation("Idle_01"),this.loopAnimation=!0,this.isIdle=!0,this.char.state.removeListener(this.startListener),this._currentAnimation="")}onTalkComplete(e){this.char&&(1===e.trackIndex||2===e.trackIndex)&&(this.isIdle=!0,this.char.state.setEmptyAnimation(1,.2),this.char.state.setEmptyAnimation(2,.2),this.char.state.removeListener(this.talkListener),this._currentAnimation="")}setListener(e){this.listener=e,this.char.state.addListener(this.listener)}clearListener(){this.char.state.removeListener(this.listener),this.listener={end:e=>{},start:e=>{}}}start(){this.char&&null!=this.getAnimation("Start_Idle_01")&&(this._currentAnimation="Start_Idle_01",this.playAnimation("Start_Idle_01"),this.char.state.addListener(this.startListener))}idle(){this.char&&null!=this.getAnimation("Idle_01")&&(this.playAnimation("Idle_01"),this.loopAnimation=!0,this.isIdle=!0)}randomTalk(){if(!this.char||(void 0!==this.howl&&this.howl.stop(),!this.isIdle))return;let e=this.getAnimations().filter(e=>e.startsWith("Talk_")&&e.endsWith("_M"));if(0===e.length)return;let t=Math.floor(Math.random()*e.length),a=e[t];if(this._currentAnimation=a,a.endsWith("_M")){let e=a.slice(0,-2)+"_A";this.char.state.hasAnimation(e)&&this.char.state.setAnimation(2,e,!1)}else this.char.state.clearTrack(2);return this.isIdle=!1,this.char.state.setAnimation(1,a,!1),this.char.state.addListener(this.talkListener),a}get currentAnimation(){return this._currentAnimation}scale(e){this._scale=e??this._scale,super.scale(e)}async loadModel(e){await super.loadModel(e),this.scale(this._scale),this.char.stateData.defaultMix=.2}};var o=a(9885),c=a(3118),u=a(8049),d=a(3050),p=a(1726),h=a(2838),m=a(292);let f=[u,d,p,h,m],initialize=async e=>{let t="";switch(e){case"jp":t=`${e}`;break;case"en":t=`${e}/Preload`}await new Promise(e=>{(0,c.q)(async()=>{for(let e of f)e.data.length=0,await e.initialize(t);e(1)})})},getSubtitles=(e,t)=>{if(!t.charId&&!t.devName)return[];let a=t.charId||(0,r.U)(t.devName);if(-1===a)return[];let i=d.data.filter(e=>e.CharacterId===a&&"UILobbySpecial"===e.DialogCategory);if(0===i.length)return[];let s=[],n=!1;for(let t=0;t<i.length;t++){let a=i[t];if(a.AnimationName===e)n=!0;else if(a.AnimationName!==e&&""!==a.AnimationName&&n)break;n&&(""!==a.LocalizeEN&&void 0!==a.LocalizeEN?s.push(a.LocalizeEN):s.push(a.LocalizeJP))}if(0===s.length&&e.includes("Talk_")){let t=parseInt(e.replace("Talk_","").replace("Dev_Talk_","").split("_")[0]);for(let e=0;e<i.length;e++){let a=i[e];a.GroupId===t&&"Talk"===a.DialogType&&(""!==a.LocalizeEN&&void 0!==a.LocalizeEN?s.push(a.LocalizeEN):s.push(a.LocalizeJP))}}return s};async function fetchModels(e){let t=await fetch(e).then(e=>e.json()),a=Object.keys(t).reduce((e,a)=>{let i=t[a];return e[a]=i,e},{});return a}let getLocalName=e=>{let t=e.replace("_home",""),a=t,i=(0,r.F)(t);return t===i&&(i=(0,r.F)(`${t}_default`),a=`${t}_default`,i===`${t}_default`&&(i=(0,r.F)(`${t.substring(0,t.length-1)}_default`),a=`${t.substring(0,t.length-1)}_default`,i===`${t.substring(0,t.length-1)}_default`&&(i=e,a=e))),[i,a]};function showSubtitles(e,t,a){e.innerHTML="";let i=getSubtitles(t,{devName:a});for(let t of i){let a=document.createElement("p");a.innerText=t,a.classList.add("text-xl","text-gray-200","mb-2","p-2","bg-neutral-800","bg-opacity-80"),e.appendChild(a)}}function Home(){let e=(0,o.createRef)(),[t,a]=(0,o.useState)({}),[s,r]=(0,o.useState)(!1),[l,c]=(0,o.useState)({selectedModel:"airi0_home",scale:.8,playVoice:!1,voiceVolume:1,tapToTalk:!1,maxFPS:60,subtitle:"none"}),u=(0,o.useRef)(l),updateSelectedModel=e=>{c(t=>({...t,selectedModel:e}))},updateScale=e=>{c(t=>({...t,scale:e}))},updatePlayVoice=e=>{c(t=>({...t,playVoice:e}))},updateVoiceVolume=e=>{c(t=>({...t,voiceVolume:e}))},updateTapToTalk=e=>{c(t=>({...t,tapToTalk:e}))},updateMaxFPS=e=>{c(t=>({...t,maxFPS:e}))},updateSubtitle=e=>{c(t=>({...t,subtitle:e}))};return(0,o.useEffect)(()=>{u.current=l},[l]),(0,o.useEffect)(()=>{window.wallpaperPropertyListener={applyUserProperties:async function(e){if(e.play_voice&&(updatePlayVoice(e.play_voice.value),i.playVoice=e.play_voice.value),e.tap_to_talk&&updateTapToTalk(e.tap_to_talk.value),e.voice_volume&&(updateVoiceVolume(e.voice_volume.value/100),i.voiceVolume=e.voice_volume.value/100),e.model&&l.selectedModel!==e.model.value&&(updateSelectedModel(e.model.value),Object.keys(t).length>0&&i)){let e=t[l.selectedModel];for(let t=0;t<e.length;t++){let a=e[t];0==t?await i.loadModel(a):await i.addSpine(a,t.toString(),0)}i.center(),i.scale(l.scale),i.start()}e.scale&&(updateScale(e.scale.value),i.scale(e.scale.value)),e.subtitle&&updateSubtitle(e.subtitle.value),u.current=l},applyGeneralProperties:async function(e){e.fps&&(updateMaxFPS(e.fps),i.app.ticker.maxFPS=e.fps.value)}}},[]),(0,o.useEffect)(()=>{(async()=>{if(Object.keys(t).length>0)return;let initialize=async()=>{if(void 0!==i)return;i=new Live2DViewer(document.getElementById("canvas"));let e=await fetchModels("./data/jp/Android/info.json");a(e)};await initialize()})()},[l.selectedModel]),(0,o.useEffect)(()=>{r(!1),(async()=>{let reload=async()=>{let e=t[l.selectedModel];for(let t=0;t<e.length;t++){let a=e[t];0==t?await i.loadModel(a):await i.addSpine(a,t.toString(),0)}r(!0),i.center(),i.start()};Object.keys(t).length>0&&await reload()})()},[l.selectedModel,t]),(0,o.useEffect)(()=>{function start(){let t=i.currentAnimation;if(console.log(e.current),!t||!e.current||(e.current.innerHTML="","none"==u.current.subtitle))return;let[a,s]=getLocalName(u.current.selectedModel);console.log("showing subtitles"),e.current.classList.remove("opacity-0"),e.current.classList.add("opacity-100"),showSubtitles(e.current,t,s)}function end(){console.log("clearing subtitles"),e.current&&(e.current.classList.remove("opacity-100"),e.current.classList.add("opacity-0"),setTimeout(()=>{e.current&&(e.current.innerHTML="")},300))}s&&i.setListener({start:start,end:end})},[e,l.selectedModel,s]),(0,o.useEffect)(()=>{"none"==l.subtitle?e.current&&(e.current.innerHTML=""):initialize(l.subtitle)},[l.subtitle]),(0,n.jsxs)("div",{className:"w-full h-full flex items-center justify-center",children:[n.jsx("canvas",{id:"canvas",onClick:e=>{console.log(e.clientX,e.clientY,e.target),!i.currentAnimation&&l.tapToTalk&&i.randomTalk()}}),n.jsx("div",{className:"w-auto h-auto fixed bottom-24 flex flex-col transition-all duration-300 opacity-100",ref:e})]})}!function(e){e.none="none",e.en="en",e.jp="jp"}(s||(s={}))},4922:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>r,__esModule:()=>n,default:()=>o});var i=a(5153);let s=(0,i.createProxy)(String.raw`D:\Project\blue-archive\app\wpengine\page.tsx`),{__esModule:n,$$typeof:r}=s,l=s.default,o=l}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[862,120,52,174,79,263],()=>__webpack_exec__(1287));module.exports=a})();