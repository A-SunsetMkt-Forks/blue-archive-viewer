(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[541],{5009:function(e,t,a){Promise.resolve().then(a.bind(a,2871))},910:function(e,t,a){"use strict";a.d(t,{F:function(){return localizeCharFromDevName},U:function(){return findCharIdFromDevName}});var i=a(5961);function localizeCharFromDevName(e){let t=findCharIdFromDevName(e);if(-1!==t){let a=i.BJ.data.find(e=>e.CharacterId===t);return a?""===a.FamilyNameEn||void 0===a.FamilyNameEn?a.FullNameJp:"".concat([a.FamilyNameEn,a.PersonalNameEn].join(" ")):e}return e}function findCharIdFromDevName(e){var t;let a=null===(t=i.zk.data.find(t=>(t.DevName.toLowerCase()===e.toLowerCase()||t.ScenarioCharacter.toLowerCase()===e.toLowerCase())&&(t.IsPlayable||t.IsPlayableCharacter)))||void 0===t?void 0:t.Id;return a||-1}},2783:function(e,t,a){"use strict";a.d(t,{w:function(){return i}});let i="https://prod-clientpatch.bluearchiveyostar.com/r67_jjjg51ngucokd90cuk4l_3"},6667:function(e,t,a){"use strict";a.d(t,{X:function(){return get_origin}});let get_origin=()=>{if("file://"!==window.location.origin)return window.location.origin;let e=document.createElement("script");e.src="dummy.js";let t=e.src;return t.substring(0,t.lastIndexOf("/")+1)}},7118:function(e,t,a){"use strict";a.d(t,{b:function(){return Live2DViewer}});var i=a(7432),n=a(6720),l=a(3171),s=a(2783);function calculateFitScale(e,t,a,i){return Math.min(a/e,i/t)}function calculateFillScale(e,t,a,i){let n=a/e,l=i/t;console.log("widthScale: ".concat(n," heightScale: ").concat(l));let s=Math.max(n,l);return s}let Live2DViewer=class Live2DViewer{resizeCanvas(e,t,a){a.width=e,a.height=t,this.app.renderer.resize(e,t)}async loadModel(e){this.clearStage();let t=await this.addSpine(e,"char");if(this.char=t,t.state.hasAnimation("Start_Idle_01"))this.playAnimation("Start_Idle_01");else{let e=t.state.data.skeletonData.animations[0];this.playAnimation(e.name)}t.state.addListener({event:async(e,a)=>{if(!this.playVoice||"Talk"!==a.data.name)return;void 0!==this.howl&&this.howl.stop();let i=a.stringValue+".ogg",n=i.split("_")[0],s="".concat(this.baseURL,"/MediaResources/Audio/VOC_JP/JP_").concat(n,"/").concat(i),r=await fetch(s,{mode:"no-cors"});r.ok||(n=n[0].toUpperCase()+n.slice(1),i=i[0].toUpperCase()+i.slice(1),s="".concat(this.baseURL,"/MediaResources/Audio/VOC_JP/JP_").concat(n,"/").concat(i)),this.howl=new l.Howl({volume:this.voiceVolume,src:"".concat(this.baseURL,"/MediaResources/Audio/VOC_JP/JP_").concat(n,"/").concat(i)}),"loaded"===this.howl.state()?this.howl.play():(t.state.timeScale=0,this.howl.on("load",()=>{this.howl.play(),t.state.timeScale=1}),this.howl.on("loaderror",()=>{console.error("Failed to load voice line."),t.state.timeScale=1}))}})}clearStage(){this.app.stage=new n.W20,void 0!==this.howl&&this.howl.stop()}async addSpine(e,t,a){let l=await n.deM.load(e),s=new i.PY(l.spineData);s.name=t,void 0!==a?this.app.stage.addChildAt(s,a):this.app.stage.addChild(s);let r=calculateFillScale(s.spineData.width,s.spineData.height,this.app.renderer.width,this.app.renderer.height);return r=Math.ceil(10*r)/10,s.scale.set(r),s}resize(e,t){let a=this.app.stage.children;a.forEach(a=>{if(!(a instanceof i.PY))return;let n=e?e/a.spineData.width:a.scale.x,l=t?t/a.spineData.height:a.scale.y;n=Math.round(10*n)/10,l=Math.round(10*l)/10,a.scale.set(n,l)})}fillScale(){let e=0;return this.app.stage.children.forEach(t=>{if(!(t instanceof i.PY))return;let a=calculateFillScale(t.spineData.width,t.spineData.height,this.app.renderer.width,this.app.renderer.height);a=Math.ceil(10*a)/10,t.scale.set(a),e=a}),e}fitScale(){let e=0;return this.app.stage.children.forEach(t=>{if(!(t instanceof i.PY))return;let a=calculateFitScale(t.spineData.width,t.spineData.height,this.app.renderer.width,this.app.renderer.height);a=Math.ceil(100*a)/100,t.scale.set(a),e=a}),e}scale(e){let t=this.app.stage.children;t.forEach(t=>{if(!(t instanceof i.PY))return;let a=null!=e?e:t.scale.x,n=null!=e?e:t.scale.y;a=Math.round(10*a)/10,n=Math.round(10*n)/10,t.scale.set(a,n)})}move(e,t){let a=this.app.stage.children;a.forEach(a=>{let i=null!=e?e:a.x,n=null!=t?t:a.y;i=Math.round(i),n=Math.round(n),a.x=i,a.y=n})}center(){let e=this.app.stage.children,[t,a]=[0,0];return e.forEach(e=>{e instanceof i.PY&&(e.x=this.app.renderer.width/2,e.spineData.height*e.scale.y<this.app.renderer.height?e.y=this.app.renderer.height-e.spineData.height*e.scale.y*1.25:e.y=this.app.renderer.height,[t,a]=[e.x,e.y])}),[t,a]}playAnimation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.char){if(void 0!==this.howl&&this.howl.stop(),e.endsWith("_M")){let t=e.slice(0,-2)+"_A";this.char.state.hasAnimation(t)&&this.char.state.setAnimation(2,t,this.loopAnimation)}else this.char.state.clearTrack(2);e.includes("Idle")?this.char.state.clearTrack(1):this.char.state.hasAnimation("Idle_01")&&this.char.state.setAnimation(1,"Idle_01",!0),this.char.state.setAnimation(0,e,this.loopAnimation),this.char.state.addListener({complete:t.onComplete})}}getAnimation(e){if(!this.char)return;let t=this.char.state.data.skeletonData.animations,a=t.find(t=>t.name===e);return a}getAnimations(){if(!this.char)return[];let e=this.char.state.data.skeletonData.animations,t=e.map(e=>e.name);return t}get loopAnimation(){return this._loopAnimation}set loopAnimation(e){this.char&&(void 0!==this.howl&&this.howl.stop(),this._loopAnimation=e,this.char.state.tracks[0].loop=e)}constructor(e){this.playVoice=!1,this.voiceVolume=1,this.baseURL=s.w,this._loopAnimation=!1,e.width=window.innerWidth,e.height=window.innerHeight,this.app=new n.MxU({width:window.innerWidth,height:window.innerHeight,view:e})}}},2135:function(e,t,a){"use strict";a.r(t),a.d(t,{data:function(){return n},initialize:function(){return initialize}});var i=a(6667);let n=[],initialize=async e=>{let t=(0,i.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/AcademyFavorScheduleExcelTable.json")).then(e=>e.json());n.push(...a)}},2707:function(e,t,a){"use strict";a.r(t),a.d(t,{data:function(){return n},initialize:function(){return initialize}});var i=a(6667);let n=[],initialize=async e=>{let t=(0,i.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/CharacterExcelTable.json")).then(e=>e.json());n.push(...a)}},2102:function(e,t,a){"use strict";a.r(t),a.d(t,{data:function(){return n},initialize:function(){return initialize}});var i=a(6667);let n=[],initialize=async e=>{let t=(0,i.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/CharacterDialogExcelTable.json")).then(e=>e.json());n.push(...a)}},5961:function(e,t,a){"use strict";a.d(t,{BJ:function(){return r},K$:function(){return l},j2:function(){return initialize},yB:function(){return o},zk:function(){return s}});var i=a(7480),n=a(2135),l=a(2102),s=a(2707),r=a(1382),o=a(2611);let c=[n,l,s,r,o],initialize=async e=>{let t="";switch(e){case"jp":t="".concat(e);break;case"en":t="".concat(e,"/Preload")}await new Promise(e=>{(0,i.q)(async()=>{for(let e of c)0===e.data.length&&await e.initialize(t);e(1)})})}},1382:function(e,t,a){"use strict";a.r(t),a.d(t,{data:function(){return n},initialize:function(){return initialize}});var i=a(6667);let n=[],initialize=async e=>{let t=(0,i.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/LocalizeCharProfileExcelTable.json")).then(e=>e.json());n.push(...a)}},2611:function(e,t,a){"use strict";a.r(t),a.d(t,{data:function(){return n},initialize:function(){return initialize}});var i=a(6667);let n=[],initialize=async e=>{let t=(0,i.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/MemoryLobbyExcelTable.json")).then(e=>e.json());n.push(...a)}},7480:function(e,t,a){"use strict";a.d(t,{q:function(){return runOnClient}});let runOnClient=e=>{"loading"==window.document.readyState?window.addEventListener("load",e):e()}},2871:function(e,t,a){"use strict";let i;a.r(t),a.d(t,{default:function(){return Home}});var n,l,s=a(7437),r=a(910),o=a(7118);let Live2DViewer=class Live2DViewer extends o.b{onStartComplete(e){this.char&&(this.playAnimation("Idle_01"),this.loopAnimation=!0,this.isIdle=!0,this.char.state.removeListener(this.startListener),this._currentAnimation="")}onTalkComplete(e){this.char&&(1===e.trackIndex||2===e.trackIndex)&&(this.isIdle=!0,this.char.state.setEmptyAnimation(1,.2),this.char.state.setEmptyAnimation(2,.2),this.char.state.removeListener(this.talkListener),this._currentAnimation="")}setListener(e){this.listener=e,this.char.state.addListener(this.listener)}clearListener(){this.char.state.removeListener(this.listener),this.listener={end:e=>{},start:e=>{}}}start(){this.char&&null!=this.getAnimation("Start_Idle_01")&&(this._currentAnimation="Start_Idle_01",this.playAnimation("Start_Idle_01"),this.char.state.addListener(this.startListener))}idle(){this.char&&null!=this.getAnimation("Idle_01")&&(this.playAnimation("Idle_01"),this.loopAnimation=!0,this.isIdle=!0)}randomTalk(){if(!this.char||(void 0!==this.howl&&this.howl.stop(),!this.isIdle))return;let e=this.getAnimations().filter(e=>e.startsWith("Talk_")&&e.endsWith("_M"));if(0===e.length)return;let t=Math.floor(Math.random()*e.length),a=e[t];if(this._currentAnimation=a,a.endsWith("_M")){let e=a.slice(0,-2)+"_A";this.char.state.hasAnimation(e)&&this.char.state.setAnimation(2,e,!1)}else this.char.state.clearTrack(2);return this.isIdle=!1,this.char.state.setAnimation(1,a,!1),this.char.state.addListener(this.talkListener),a}get currentAnimation(){return this._currentAnimation}scale(e){this._scale=null!=e?e:this._scale,super.scale(e)}async loadModel(e){await super.loadModel(e),this.scale(this._scale),this.char.stateData.defaultMix=.2}constructor(e){super(e),this.isIdle=!1,this._scale=1,this.startListener={end:()=>{}},this.talkListener={end:()=>{}},this.listener={end:e=>{},start:e=>{}},this._currentAnimation="",this.talkListener.complete=this.onTalkComplete.bind(this),this.startListener.complete=this.onStartComplete.bind(this)}};var c=a(2265),h=a(7480),u=a(2135),d=a(2102),p=a(2707),f=a(1382),m=a(2611);let w=[u,d,p,f,m],initialize=async e=>{let t="";switch(e){case"jp":t="".concat(e);break;case"en":t="".concat(e,"/Preload")}await new Promise(e=>{(0,h.q)(async()=>{for(let e of w)e.data.length=0,await e.initialize(t);e(1)})})},getSubtitles=(e,t)=>{if(!t.charId&&!t.devName)return[];let a=t.charId||(0,r.U)(t.devName);if(-1===a)return[];let i=d.data.filter(e=>e.CharacterId===a&&"UILobbySpecial"===e.DialogCategory);if(0===i.length)return[];let n=[],l=!1;for(let t=0;t<i.length;t++){let a=i[t];if(a.AnimationName===e)l=!0;else if(a.AnimationName!==e&&""!==a.AnimationName&&l)break;l&&(""!==a.LocalizeEN&&void 0!==a.LocalizeEN?n.push(a.LocalizeEN):n.push(a.LocalizeJP))}if(0===n.length&&e.includes("Talk_")){let t=parseInt(e.replace("Talk_","").replace("Dev_Talk_","").split("_")[0]);for(let e=0;e<i.length;e++){let a=i[e];a.GroupId===t&&"Talk"===a.DialogType&&(""!==a.LocalizeEN&&void 0!==a.LocalizeEN?n.push(a.LocalizeEN):n.push(a.LocalizeJP))}}return n};async function fetchModels(e){let t=await fetch(e).then(e=>e.json()),a=Object.keys(t).reduce((e,a)=>{let i=t[a];return e[a]=i,e},{});return a}let getLocalName=e=>{let t=e.replace("_home",""),a=t,i=(0,r.F)(t);return t===i&&(i=(0,r.F)("".concat(t,"_default")),a="".concat(t,"_default"),i==="".concat(t,"_default")&&(i=(0,r.F)("".concat(t.substring(0,t.length-1),"_default")),a="".concat(t.substring(0,t.length-1),"_default"),i==="".concat(t.substring(0,t.length-1),"_default")&&(i=e,a=e))),[i,a]};function showSubtitles(e,t,a){e.innerHTML="";let i=getSubtitles(t,{devName:a});for(let t of i){let a=document.createElement("p");a.innerText=t,a.classList.add("text-xl","text-gray-200","mb-2","p-2","bg-neutral-800","bg-opacity-80"),e.appendChild(a)}}function Home(){let e=(0,c.createRef)(),[t,a]=(0,c.useState)({}),[n,l]=(0,c.useState)(!1),[r,o]=(0,c.useState)({selectedModel:"airi0_home",scale:.8,playVoice:!1,voiceVolume:1,tapToTalk:!1,maxFPS:60,subtitle:"none"}),h=(0,c.useRef)(r),updateSelectedModel=e=>{o(t=>({...t,selectedModel:e}))},updateScale=e=>{o(t=>({...t,scale:e}))},updatePlayVoice=e=>{o(t=>({...t,playVoice:e}))},updateVoiceVolume=e=>{o(t=>({...t,voiceVolume:e}))},updateTapToTalk=e=>{o(t=>({...t,tapToTalk:e}))},updateMaxFPS=e=>{o(t=>({...t,maxFPS:e}))},updateSubtitle=e=>{o(t=>({...t,subtitle:e}))};return(0,c.useEffect)(()=>{h.current=r},[r]),(0,c.useEffect)(()=>{window.wallpaperPropertyListener={applyUserProperties:async function(e){if(e.play_voice&&(updatePlayVoice(e.play_voice.value),i.playVoice=e.play_voice.value),e.tap_to_talk&&updateTapToTalk(e.tap_to_talk.value),e.voice_volume&&(updateVoiceVolume(e.voice_volume.value/100),i.voiceVolume=e.voice_volume.value/100),e.model&&r.selectedModel!==e.model.value&&(updateSelectedModel(e.model.value),Object.keys(t).length>0&&i)){let e=t[r.selectedModel];for(let t=0;t<e.length;t++){let a=e[t];0==t?await i.loadModel(a):await i.addSpine(a,t.toString(),0)}i.center(),i.scale(r.scale),i.start()}e.scale&&(updateScale(e.scale.value),i.scale(e.scale.value)),e.subtitle&&updateSubtitle(e.subtitle.value),h.current=r},applyGeneralProperties:async function(e){e.fps&&(updateMaxFPS(e.fps),i.app.ticker.maxFPS=e.fps.value)}}},[]),(0,c.useEffect)(()=>{(async()=>{if(Object.keys(t).length>0)return;let initialize=async()=>{if(void 0!==i)return;i=new Live2DViewer(document.getElementById("canvas"));let e=await fetchModels("./data/jp/Android/info.json");a(e)};await initialize()})()},[r.selectedModel]),(0,c.useEffect)(()=>{l(!1),(async()=>{let reload=async()=>{let e=t[r.selectedModel];for(let t=0;t<e.length;t++){let a=e[t];0==t?await i.loadModel(a):await i.addSpine(a,t.toString(),0)}l(!0),i.center(),i.start()};Object.keys(t).length>0&&await reload()})()},[r.selectedModel,t]),(0,c.useEffect)(()=>{function start(){let t=i.currentAnimation;if(console.log(e.current),!t||!e.current||(e.current.innerHTML="","none"==h.current.subtitle))return;let[a,n]=getLocalName(h.current.selectedModel);console.log("showing subtitles"),e.current.classList.remove("opacity-0"),e.current.classList.add("opacity-100"),showSubtitles(e.current,t,n)}function end(){console.log("clearing subtitles"),e.current&&(e.current.classList.remove("opacity-100"),e.current.classList.add("opacity-0"),setTimeout(()=>{e.current&&(e.current.innerHTML="")},300))}n&&i.setListener({start:start,end:end})},[e,r.selectedModel,n]),(0,c.useEffect)(()=>{"none"==r.subtitle?e.current&&(e.current.innerHTML=""):initialize(r.subtitle)},[r.subtitle]),(0,s.jsxs)("div",{className:"w-full h-full flex items-center justify-center",children:[(0,s.jsx)("canvas",{id:"canvas",onClick:e=>{console.log(e.clientX,e.clientY,e.target),!i.currentAnimation&&r.tapToTalk&&i.randomTalk()}}),(0,s.jsx)("div",{className:"w-auto h-auto fixed bottom-24 flex flex-col transition-all duration-300 opacity-100",ref:e})]})}(n=l||(l={})).none="none",n.en="en",n.jp="jp"}},function(e){e.O(0,[614,971,472,744],function(){return e(e.s=5009)}),_N_E=e.O()}]);