"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[628],{5628:function(e,t,a){a.d(t,{S:function(){return Live2DPage}});var n,i=a(7437);function InputCheckbox(e){return(0,i.jsx)("div",{className:"flex flex-col",children:(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)("input",{type:"checkbox",name:e.id,id:e.id,className:"mr-2",defaultChecked:!!e.defaultChecked&&e.defaultChecked,onChange:t=>{e.onChange(t.target.checked)},ref:e.reference}),(0,i.jsx)("label",{htmlFor:e.id,className:"text-l",children:e.label})]})})}function InputSelect(e){return(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("label",{htmlFor:e.id,className:"text-xl mt-4 mb-2 text-gray-200",children:e.label}),(0,i.jsx)("select",{ref:e.reference,id:e.id,className:"h-10 text-gray-100 rounded-l bg-neutral-950 border-gray-400 border-2",onChange:t=>e.onChange(t.target.value),children:e.options.map(e=>(0,i.jsx)("option",{value:e.value,children:e.label},e.value))})]})}var l=a(2265),r=a(7118);async function fetchModels(e){let t=await fetch(e).then(e=>e.json()),a=Object.keys(t).reduce((e,a)=>{let n=t[a];return e[a]=n,e},{});return a}var o=a(5961),s=a(6667),c=a(910);let getBGM=e=>{let t=o.yB.data.find(t=>t.CharacterId===e);return t?t.BGMId:-1},getBGMByDevName=e=>{let t=(0,c.U)(e);return -1!==t?getBGM(t):-1},getSubtitles=(e,t)=>{if(!t.charId&&!t.devName)return[];let a=t.charId||(0,c.U)(t.devName);if(-1===a)return[];let n=o.K$.data.filter(e=>e.CharacterId===a&&"UILobbySpecial"===e.DialogCategory);if(0===n.length)return[];let i=[],l=!1;for(let t=0;t<n.length;t++){let a=n[t];if(a.AnimationName===e)l=!0;else if(a.AnimationName!==e&&""!==a.AnimationName&&l)break;l&&(""!==a.LocalizeEN&&void 0!==a.LocalizeEN?i.push(a.LocalizeEN):i.push(a.LocalizeJP))}if(0===i.length&&e.includes("Talk_")){let t=parseInt(e.replace("Talk_","").replace("Dev_Talk_","").split("_")[0]);for(let e=0;e<n.length;e++){let a=n[e];a.GroupId===t&&"Talk"===a.DialogType&&(""!==a.LocalizeEN&&void 0!==a.LocalizeEN?i.push(a.LocalizeEN):i.push(a.LocalizeJP))}}return i},toast=e=>{let t=document.createElement("div");t.className="w-full h-auto fixed top-24 flex justify-center items-center";let a=document.createElement("div");a.className="bg-rose-700 px-4 py-3 shadow-lg rounded-md transition-all duration-1000 opacity-100";let n=document.createElement("p");n.className="text-gray-100 text-xl",n.id="toast",n.innerText=e,a.appendChild(n),t.appendChild(a),document.body.appendChild(t),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>{document.body.removeChild(t)},1e3)},3e3)},exporter=async function(e,t){let a,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:60,l=arguments.length>4?arguments[4]:void 0,r=document.getElementById("canvas"),o=r.captureStream(i),s=new MediaRecorder(o,{mimeType:"video/webm; codecs=vp9",videoBitsPerSecond:1048576*n}),c=[];s.addEventListener("dataavailable",e=>{c.push(e.data)}),s.addEventListener("stop",()=>{let e=new Blob(c,{type:"video/webm"}),t=URL.createObjectURL(e);a=t}),s.start();let d=e.playVoice.checked,u=e.loopAnimation.checked;t.playVoice=!1,t.loopAnimation=!1,t.playAnimation(e.animationSelect.value,{onComplete(){s.stop(),t.playVoice=d,t.loopAnimation=u}});let h=t.getAnimation(e.animationSelect.value),f=h.duration,m=0;return new Promise(e=>{let t=setInterval(()=>{(null==l?void 0:l.onPercentChange)&&(m++,l.onPercentChange(m)),a&&(clearInterval(t),e(a))},10*f)})};var d=a(2783);let CloseSetting=e=>{e.classList.add("-left-full"),e.classList.remove("left-0")},OpenSetting=e=>{e.classList.add("left-0"),e.classList.remove("-left-full")},PlayVoiceOnChanged=(e,t)=>{t.playVoice=e},ReloadAnimations=(e,t)=>{for(let a of(e.innerHTML="",t)){let t=document.createElement("option");t.value=a,t.innerText=a,e.appendChild(t),"Start_Idle_01"===t.innerText&&(t.selected=!0)}},ReloadModels=function(e,t){let a=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(a){let e=Object.entries(t).sort((e,t)=>{let[a,n]=getLocalName(e[0]),[i,l]=getLocalName(t[0]);return a.localeCompare(i)});t=Object.fromEntries(e)}e.innerHTML="";let n=!1;for(let[a,i]of Object.entries(t)){let t=document.createElement("option"),[l,r]=getLocalName(a);t.value=JSON.stringify(i),t.innerText="".concat(l," (").concat(a,")"),t.setAttribute("data-devname",r),t.setAttribute("model",a),e.appendChild(t),n||(t.selected=!0,n=!0)}},getLocalName=e=>{let t=e.replace("_home",""),a=t,n=(0,c.F)(t);return t===n&&(n=(0,c.F)("".concat(t,"_default")),a="".concat(t,"_default"),n==="".concat(t,"_default")&&(n=(0,c.F)("".concat(t.substring(0,t.length-1),"_default")),a="".concat(t.substring(0,t.length-1),"_default"),n==="".concat(t.substring(0,t.length-1),"_default")&&(n=e,a=e))),[n,a]},AnimationOnChanged=(e,t)=>{let a=e.animationSelect,n=a.value;e.subtitle.innerHTML="",t.playAnimation(n),showSubtitles(e)},DownloadAsWallpaperEngine=async e=>{let{modelSelect:t}=e,a=t.selectedOptions[0].getAttribute("model"),n=document.createElement("a");n.href="/api/download?id=".concat(a),n.download="ba_wpengine@".concat(a,".zip"),n.click()},LoadModel=async(e,t)=>{let{modelSelect:a,animationSelect:n,offsetX:i,offsetY:l,scale:r}=e,o=JSON.parse(a.value),s=[];n.innerHTML="";for(let e=0;e<o.length;e++){let a=o[e];if(0===e){await t.loadModel(a),s=t.getAnimations();let e=t.char;if(void 0===e)continue;r.value=e.scale.x.toString()}else await t.addSpine(a,e.toString(),0)}let[c,d]=t.center();i.value=c.toString(),l.value=d.toString(),e.subtitle.innerHTML="",ReloadAnimations(n,s),ReloadBGM(e)},ScaleChanged=(e,t)=>{let{scale:a}=e,n=parseFloat(a.value);t.scale(n)},OffsetChanged=(e,t)=>{let{offsetX:a,offsetY:n}=e,i=parseFloat(a.value),l=parseFloat(n.value);t.move(i,l)},OffsetCenter=(e,t)=>{let[a,n]=t.center();e.offsetX.value=a.toString(),e.offsetY.value=n.toString()},ScaleFill=(e,t)=>{let a=t.fillScale();e.scale.value=a.toString()},ScaleFit=(e,t)=>{let a=t.fitScale();e.scale.value=a.toString()},OnResize=(e,t,a)=>{let n=/iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);n||(console.log("[Live2DViewer] Resize: ".concat(window.innerWidth,"x").concat(window.innerHeight)),a.resizeCanvas(window.innerWidth,window.innerHeight,document.getElementById("canvas")),OffsetCenter(t,a))},ReloadBGM=e=>{if(void 0===e.playBGM)return;let{playBGM:t}=e,a=e.audioBGM;if(t.checked){let t=e.modelSelect.selectedOptions[0],n=t.getAttribute("data-devname"),i=getBGMByDevName(n),l=i.toString().padStart(2,"0"),r="".concat(d.w,"/MediaResources/Audio/BGM/Theme_").concat(l,".ogg");a.src=r,a.hidden=!1,a.play().catch(e=>{toast("Failed to play BGM: ".concat(e)),a.hidden=!0})}else a.src="",a.hidden=!0,a.pause()},showSubtitles=e=>{let t=e.animationSelect.value,a=e.modelSelect.selectedOptions[0].getAttribute("data-devname"),n=getSubtitles(t,{devName:a}),i=e.subtitle;for(let e of(i.innerHTML="",n)){let t=document.createElement("p");t.innerText=e,t.classList.add("text-xl","text-gray-200","mb-2","p-2","bg-neutral-800","bg-opacity-80"),i.appendChild(t)}},u=!1,[h,f]=[0,0],[m,p]=[0,0],[x,g]=[0,0],v=0,b=!1,getDistance=(e,t)=>{let a=e.clientX-t.clientX,n=e.clientY-t.clientY;return Math.sqrt(a*a+n*n)},EnableDragging=(e,t)=>{let a=document.getElementById("canvas");a.onpointerdown=t=>{b||(u=!0,[h,f]=[-e.offsetX.valueAsNumber,-e.offsetY.valueAsNumber],[x,g]=[t.clientX-h,t.clientY-f])},a.onpointerup=()=>{u=!1},a.onpointerout=()=>{u=!1},a.onpointermove=a=>{!b&&u&&([m,p]=[a.clientX-h,a.clientY-f],(x-m!=0||g-p!=0)&&(e.offsetX.value=(-(h+x-m)).toString(),e.offsetY.value=(-(f+g-p)).toString(),OffsetChanged(e,t)))},a.addEventListener("touchstart",e=>{2===e.touches.length&&(v=getDistance(e.touches[0],e.touches[1]),b=!0)}),a.addEventListener("touchend",()=>{b=!1}),a.addEventListener("touchmove",a=>{if(b&&2===a.touches.length){let n=getDistance(a.touches[0],a.touches[1]),i=n-v;if(0!==i){let a=e.scale.valueAsNumber+i/2e3;if(a<parseFloat(e.scale.min)||a>parseFloat(e.scale.max))return;e.scale.value=a.toString(),ScaleChanged(e,t)}v=n}})},ExportAs=async(e,t)=>{let{exportBitrate:a,exportFPS:n,modal:i,progressBar:l,modalClose:r}=e,o=a.valueAsNumber,s=n.valueAsNumber,c=null==i?void 0:i.querySelector("video"),d=null==i?void 0:i.querySelector("p");d.innerText="Exporting...",null==i||i.classList.remove("hidden"),null==r||r.classList.add("hidden"),null==l||l.style.setProperty("width","0%"),c.src="";let u=await exporter(e,t,o,s,{onPercentChange(e){null==l||l.style.setProperty("width","".concat(e,"%"))}});d.innerText="Exported!",null==r||r.classList.remove("hidden"),c.src=u};function InputNumber(e){return(0,i.jsx)("div",{className:"flex flex-col",children:(0,i.jsxs)("div",{className:"flex flex-row items-center justify-center",children:[(0,i.jsx)("label",{htmlFor:e.id,className:"text-l mr-2 text-gray-200",children:e.label}),(0,i.jsx)("input",{type:"number",className:"h-10 text-gray-100 rounded-l bg-neutral-950 border-gray-400 border-2 flex-grow",name:e.id,id:e.id,onChange:t=>{e.onChange&&e.onChange(t.target.valueAsNumber)},defaultValue:e.defaultValue?e.defaultValue:e.min?e.min:0,step:e.step?e.step:1,max:e.max?e.max:100,min:e.min?e.min:0,ref:e.reference})]})})}var accordion=e=>{let{title:t,children:a}=e,[n,r]=(0,l.useState)(!1);return(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsxs)("div",{className:"cursor-pointer flex justify-between items-center",onClick:()=>{r(!n)},children:[(0,i.jsx)("span",{className:"text-4xl text-gray-200",children:t}),(0,i.jsx)("svg",{className:"w-4 h-4 transform transition-transform duration-300 ".concat(n?"rotate-180":"rotate-0"),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"#fff",children:(0,i.jsx)("path",{d:"M7 10l5 5 5-5z"})})]}),(0,i.jsx)("div",{className:"transition-max-height duration-300 ease-in-out overflow-hidden ".concat(n?"max-h-screen":"max-h-0"),children:(0,i.jsx)("div",{className:"p-2 mt-4",children:a})})]})};function Button(e){return(0,i.jsx)("button",{id:e.id,className:"px-4 py-1.5 mb-2 mr-2 transition-all duration-300 text-gray-100 hover:text-neutral-950 bg-transparent hover:bg-gray-200 hover:scale-110 border-gray-400 hover:border-neutral-500 border-2 rounded-md",onClick:e.onClick,ref:e.reference,children:(0,i.jsx)("span",{className:"text-xl",children:e.label})})}var component_modal=e=>{let{children:t,className:a,reference:n,...l}=e;return(0,i.jsx)("div",{className:"w-full h-full fixed flex justify-center items-center bg-black bg-opacity-70 z-50 ".concat(a),...l,ref:n,children:(0,i.jsx)("div",{className:"bg-neutral-700 text-gray-200 h-auto w-auto p-8 shadow-xl rounded-md",children:t})})},progress_bar=e=>{let{percent:t=0,children:a,className:n,height:l=8,reference:r}=e;return(0,i.jsxs)("div",{className:n,children:[(0,i.jsx)("div",{className:"bg-gray-200 w-full h-".concat(l," rounded-md"),children:(0,i.jsx)("div",{className:"bg-rose-700 h-".concat(l," rounded-md duration-200 transition-all"),style:{width:"".concat(t,"%")},ref:r})}),a]})},w={};let Live2DPage=e=>{let{region:t}=e,a=(0,l.createRef)(),c=(0,l.createRef)(),d=(0,l.createRef)(),u=(0,l.createRef)(),h=(0,l.createRef)(),f=(0,l.createRef)(),m=(0,l.createRef)(),p=(0,l.createRef)(),x=(0,l.createRef)(),g=(0,l.createRef)(),v=(0,l.createRef)(),b=(0,l.createRef)(),y=(0,l.createRef)(),j=(0,l.createRef)(),C=(0,l.createRef)(),N=(0,l.createRef)(),S=(0,l.createRef)();return(0,l.useEffect)(()=>{c.current&&(w.settingPanel=c.current),d.current&&(w.subtitle=d.current),u.current&&(w.animationSelect=u.current),h.current&&(w.modelSelect=h.current),f.current&&(w.loopAnimation=f.current),m.current&&(w.playVoice=m.current),p.current&&(w.playBGM=p.current),x.current&&(w.scale=x.current),g.current&&(w.offsetX=g.current),v.current&&(w.offsetY=v.current),a.current&&(w.jsonData=a.current),b.current&&(w.audioBGM=b.current),y.current&&(w.exportBitrate=y.current),j.current&&(w.exportFPS=j.current),C.current&&(w.modal=C.current),N.current&&(w.progressBar=N.current),S.current&&(w.modalClose=S.current),n=new r.b(document.querySelector("canvas")),o.j2(t).then(()=>{fetchModels(w.jsonData.href).then(async e=>{document.getElementById("loading").classList.add("opacity-0"),document.getElementById("loading").classList.remove("opacity-100"),setTimeout(()=>{document.getElementById("loading").remove()},1e3);let a=(0,s.X)();for(let[t,n]of Object.entries(e))e[t]=n.map(e=>a+"/"+e);ReloadModels(w.modelSelect,e,"en"===t),LoadModel(w,n),EnableDragging(w,n)})}),window.addEventListener("resize",e=>OnResize(e,w,n))}),(0,i.jsxs)("main",{className:"h-full w-full font-sans",children:[(0,i.jsx)(component_modal,{reference:C,className:"hidden",children:(0,i.jsxs)("div",{className:"flex flex-col w-full xl:w-96",children:[(0,i.jsx)("p",{className:"text-2xl mb-4",children:"Exporting..."}),(0,i.jsx)(progress_bar,{className:"grow mb-4",height:2,percent:0,reference:N}),(0,i.jsx)("video",{controls:!0,className:"mb-4"}),(0,i.jsx)(Button,{id:"modal-close",label:"Close",reference:S,onClick:()=>{C.current.classList.add("hidden")}})]})}),(0,i.jsx)("div",{className:"w-screen h-screen fixed flex items-center justify-center z-50 bg-neutral-800 bg-opacity-80 transition-all duration-1000 opacity-100",id:"loading",children:(0,i.jsx)("p",{className:"text-2xl text-gray-100",children:"Loading..."})}),(0,i.jsx)("a",{href:"/data/jp/Android/info.json",className:"hidden",id:"jsonData",ref:a}),(0,i.jsx)("div",{className:"w-24 h-12 fixed",children:(0,i.jsx)("button",{className:"w-full h-full flex justify-center items-center border-2 border-gray-400",id:"setting-button",onClick:()=>OpenSetting(w.settingPanel),children:(0,i.jsx)("span",{"uk-icon":"cog",className:"uk-icon",children:(0,i.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg",children:[(0,i.jsx)("circle",{fill:"none",stroke:"#fff",cx:"9.997",cy:"10",r:"3.31"}),(0,i.jsx)("path",{fill:"none",stroke:"#fff",d:"M18.488,12.285 L16.205,16.237 C15.322,15.496 14.185,15.281 13.303,15.791 C12.428,16.289 12.047,17.373 12.246,18.5 L7.735,18.5 C7.938,17.374 7.553,16.299 6.684,15.791 C5.801,15.27 4.655,15.492 3.773,16.237 L1.5,12.285 C2.573,11.871 3.317,10.999 3.317,9.991 C3.305,8.98 2.573,8.121 1.5,7.716 L3.765,3.784 C4.645,4.516 5.794,4.738 6.687,4.232 C7.555,3.722 7.939,2.637 7.735,1.5 L12.263,1.5 C12.072,2.637 12.441,3.71 13.314,4.22 C14.206,4.73 15.343,4.516 16.225,3.794 L18.487,7.714 C17.404,8.117 16.661,8.988 16.67,10.009 C16.672,11.018 17.415,11.88 18.488,12.285 L18.488,12.285 Z"})]})})})}),(0,i.jsxs)("div",{className:"xl:w-96 w-full h-screen bg-neutral-800 pt-6 px-12 fixed duration-300 left-0 z-10 overflow-y-auto",id:"setting",ref:c,children:[(0,i.jsx)("div",{className:"flex flex-row justify-end text-gray-100",children:(0,i.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 14 14",xmlns:"http://www.w3.org/2000/svg",className:"cursor-pointer",id:"close",onClick:()=>CloseSetting(w.settingPanel),children:[(0,i.jsx)("line",{fill:"none",stroke:"#fff",strokeWidth:"1.1",x1:"1",y1:"1",x2:"13",y2:"13"}),(0,i.jsx)("line",{fill:"none",stroke:"#fff",strokeWidth:"1.1",x1:"13",y1:"1",x2:"1",y2:"13"})]})}),(0,i.jsxs)("div",{className:"flex flex-col pt-6 pb-12 text-gray-400",children:[(0,i.jsx)("p",{className:"text-4xl text-gray-100",children:"Settings"}),(0,i.jsx)(InputSelect,{id:"model",label:"Model",onChange:()=>{LoadModel(w,n)},options:[],reference:h}),(0,i.jsx)(InputSelect,{id:"animation",label:"Animation",onChange:()=>{AnimationOnChanged(w,n)},options:[],reference:u}),(0,i.jsx)("br",{}),(0,i.jsx)(InputCheckbox,{id:"loop-animation",label:"Loop animation",onChange:()=>{n.loopAnimation=f.current.checked},reference:f}),(0,i.jsx)(InputCheckbox,{id:"play-voice",label:"Play voice",onChange:()=>PlayVoiceOnChanged(m.current.checked,n),reference:m}),(0,i.jsx)(InputCheckbox,{id:"play-bgm",label:"Play BGM",onChange:()=>{ReloadBGM(w)},reference:p}),(0,i.jsx)("br",{}),(0,i.jsx)("audio",{src:"",preload:"auto",ref:b,loop:!0,controls:!0,hidden:!0}),(0,i.jsx)("br",{}),(0,i.jsx)(Button,{id:"download",label:"Download as Wallpaper Engine Web",onClick:()=>{DownloadAsWallpaperEngine(w)}}),(0,i.jsx)("br",{}),(0,i.jsxs)(accordion,{title:"Extras",children:[(0,i.jsx)("p",{className:"text-xl text-gray-200 mb-2",children:"Scale"}),(0,i.jsxs)("div",{className:"flex flex-row",children:[(0,i.jsx)(Button,{id:"scale-fill",label:"Fill",onClick:()=>{ScaleFill(w,n)}}),(0,i.jsx)(Button,{id:"scale-fit",label:"Fit",onClick:()=>{ScaleFit(w,n)}})]}),(0,i.jsx)(InputNumber,{id:"scale-x",label:"X",onChange:()=>{ScaleChanged(w,n)},reference:x,min:.1,max:20,step:.1}),(0,i.jsx)("br",{}),(0,i.jsx)("p",{className:"text-xl text-gray-200 mb-2",children:"Offset"}),(0,i.jsx)("div",{className:"flex flex-row",children:(0,i.jsx)(Button,{id:"offset-center",label:"Center",onClick:()=>{OffsetCenter(w,n)}})}),(0,i.jsx)("p",{className:"mb-2",children:"You can also move by dragging it."}),(0,i.jsx)(InputNumber,{id:"offset-x",label:"X",onChange:()=>{OffsetChanged(w,n)},reference:g,min:-1920,max:1920,step:1}),(0,i.jsx)(InputNumber,{id:"offset-y",label:"Y",onChange:()=>{OffsetChanged(w,n)},reference:v,min:-1080,max:1080,step:1}),(0,i.jsx)("br",{})]}),(0,i.jsx)("br",{}),(0,i.jsxs)(accordion,{title:"Export",children:[(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)(InputNumber,{id:"export-bitrate",label:"Bitrate (Mbps)",min:5,max:100,step:1,reference:y}),(0,i.jsx)(InputNumber,{id:"export-fps",label:"FPS ",defaultValue:30,min:1,max:60,step:1,reference:j})]}),(0,i.jsx)("br",{}),(0,i.jsx)(Button,{id:"export-button",label:"Go!",onClick:async()=>await ExportAs(w,n)})]})]})]}),(0,i.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,i.jsx)("canvas",{id:"canvas",onClick:()=>CloseSetting(w.settingPanel)})}),(0,i.jsx)("div",{className:"w-screen h-12 fixed bottom-0 flex justify-center items-center bg-neutral-800",children:(0,i.jsx)("p",{className:"text-gray-400",children:"Live2D Viewer"})}),(0,i.jsx)("div",{className:"sm:w-full xl:w-auto h-auto fixed bottom-24 flex flex-col xl:px-96",ref:d})]})}},910:function(e,t,a){a.d(t,{F:function(){return localizeCharFromDevName},U:function(){return findCharIdFromDevName}});var n=a(5961);function localizeCharFromDevName(e){let t=findCharIdFromDevName(e);if(-1!==t){let a=n.BJ.data.find(e=>e.CharacterId===t);return a?""===a.FamilyNameEn||void 0===a.FamilyNameEn?a.FullNameJp:"".concat([a.FamilyNameEn,a.PersonalNameEn].join(" ")):e}return e}function findCharIdFromDevName(e){var t;let a=null===(t=n.zk.data.find(t=>(t.DevName.toLowerCase()===e.toLowerCase()||t.ScenarioCharacter.toLowerCase()===e.toLowerCase())&&(t.IsPlayable||t.IsPlayableCharacter)))||void 0===t?void 0:t.Id;return a||-1}},2783:function(e,t,a){a.d(t,{w:function(){return n}});let n="https://prod-clientpatch.bluearchiveyostar.com/r67_jjjg51ngucokd90cuk4l_3"},6667:function(e,t,a){a.d(t,{X:function(){return get_origin}});let get_origin=()=>{if("file://"!==window.location.origin)return window.location.origin;let e=document.createElement("script");e.src="dummy.js";let t=e.src;return t.substring(0,t.lastIndexOf("/")+1)}},7118:function(e,t,a){a.d(t,{b:function(){return Live2DViewer}});var n=a(7432),i=a(6720),l=a(3171),r=a(2783);function calculateFitScale(e,t,a,n){return Math.min(a/e,n/t)}function calculateFillScale(e,t,a,n){let i=a/e,l=n/t;console.log("widthScale: ".concat(i," heightScale: ").concat(l));let r=Math.max(i,l);return r}let Live2DViewer=class Live2DViewer{resizeCanvas(e,t,a){a.width=e,a.height=t,this.app.renderer.resize(e,t)}async loadModel(e){this.clearStage();let t=await this.addSpine(e,"char");if(this.char=t,t.state.hasAnimation("Start_Idle_01"))this.playAnimation("Start_Idle_01");else{let e=t.state.data.skeletonData.animations[0];this.playAnimation(e.name)}t.state.addListener({event:async(e,a)=>{if(!this.playVoice||"Talk"!==a.data.name)return;void 0!==this.howl&&this.howl.stop();let n=a.stringValue+".ogg",i=n.split("_")[0],r="".concat(this.baseURL,"/MediaResources/Audio/VOC_JP/JP_").concat(i,"/").concat(n),o=await fetch(r,{mode:"no-cors"});o.ok||(i=i[0].toUpperCase()+i.slice(1),n=n[0].toUpperCase()+n.slice(1),r="".concat(this.baseURL,"/MediaResources/Audio/VOC_JP/JP_").concat(i,"/").concat(n)),this.howl=new l.Howl({volume:this.voiceVolume,src:"".concat(this.baseURL,"/MediaResources/Audio/VOC_JP/JP_").concat(i,"/").concat(n)}),"loaded"===this.howl.state()?this.howl.play():(t.state.timeScale=0,this.howl.on("load",()=>{this.howl.play(),t.state.timeScale=1}),this.howl.on("loaderror",()=>{console.error("Failed to load voice line."),t.state.timeScale=1}))}})}clearStage(){this.app.stage=new i.W20,void 0!==this.howl&&this.howl.stop()}async addSpine(e,t,a){let l=await i.deM.load(e),r=new n.PY(l.spineData);r.name=t,void 0!==a?this.app.stage.addChildAt(r,a):this.app.stage.addChild(r);let o=calculateFillScale(r.spineData.width,r.spineData.height,this.app.renderer.width,this.app.renderer.height);return o=Math.ceil(10*o)/10,r.scale.set(o),r}resize(e,t){let a=this.app.stage.children;a.forEach(a=>{if(!(a instanceof n.PY))return;let i=e?e/a.spineData.width:a.scale.x,l=t?t/a.spineData.height:a.scale.y;i=Math.round(10*i)/10,l=Math.round(10*l)/10,a.scale.set(i,l)})}fillScale(){let e=0;return this.app.stage.children.forEach(t=>{if(!(t instanceof n.PY))return;let a=calculateFillScale(t.spineData.width,t.spineData.height,this.app.renderer.width,this.app.renderer.height);a=Math.ceil(10*a)/10,t.scale.set(a),e=a}),e}fitScale(){let e=0;return this.app.stage.children.forEach(t=>{if(!(t instanceof n.PY))return;let a=calculateFitScale(t.spineData.width,t.spineData.height,this.app.renderer.width,this.app.renderer.height);a=Math.ceil(100*a)/100,t.scale.set(a),e=a}),e}scale(e){let t=this.app.stage.children;t.forEach(t=>{if(!(t instanceof n.PY))return;let a=null!=e?e:t.scale.x,i=null!=e?e:t.scale.y;a=Math.round(10*a)/10,i=Math.round(10*i)/10,t.scale.set(a,i)})}move(e,t){let a=this.app.stage.children;a.forEach(a=>{let n=null!=e?e:a.x,i=null!=t?t:a.y;n=Math.round(n),i=Math.round(i),a.x=n,a.y=i})}center(){let e=this.app.stage.children,[t,a]=[0,0];return e.forEach(e=>{e instanceof n.PY&&(e.x=this.app.renderer.width/2,e.spineData.height*e.scale.y<this.app.renderer.height?e.y=this.app.renderer.height-e.spineData.height*e.scale.y*1.25:e.y=this.app.renderer.height,[t,a]=[e.x,e.y])}),[t,a]}playAnimation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.char){if(void 0!==this.howl&&this.howl.stop(),e.endsWith("_M")){let t=e.slice(0,-2)+"_A";this.char.state.hasAnimation(t)&&this.char.state.setAnimation(2,t,this.loopAnimation)}else this.char.state.clearTrack(2);e.includes("Idle")?this.char.state.clearTrack(1):this.char.state.hasAnimation("Idle_01")&&this.char.state.setAnimation(1,"Idle_01",!0),this.char.state.setAnimation(0,e,this.loopAnimation),this.char.state.addListener({complete:t.onComplete})}}getAnimation(e){if(!this.char)return;let t=this.char.state.data.skeletonData.animations,a=t.find(t=>t.name===e);return a}getAnimations(){if(!this.char)return[];let e=this.char.state.data.skeletonData.animations,t=e.map(e=>e.name);return t}get loopAnimation(){return this._loopAnimation}set loopAnimation(e){this.char&&(void 0!==this.howl&&this.howl.stop(),this._loopAnimation=e,this.char.state.tracks[0].loop=e)}constructor(e){this.playVoice=!1,this.voiceVolume=1,this.baseURL=r.w,this._loopAnimation=!1,e.width=window.innerWidth,e.height=window.innerHeight,this.app=new i.MxU({width:window.innerWidth,height:window.innerHeight,view:e})}}},2135:function(e,t,a){a.r(t),a.d(t,{data:function(){return i},initialize:function(){return initialize}});var n=a(6667);let i=[],initialize=async e=>{let t=(0,n.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/AcademyFavorScheduleExcelTable.json")).then(e=>e.json());i.push(...a)}},2707:function(e,t,a){a.r(t),a.d(t,{data:function(){return i},initialize:function(){return initialize}});var n=a(6667);let i=[],initialize=async e=>{let t=(0,n.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/CharacterExcelTable.json")).then(e=>e.json());i.push(...a)}},2102:function(e,t,a){a.r(t),a.d(t,{data:function(){return i},initialize:function(){return initialize}});var n=a(6667);let i=[],initialize=async e=>{let t=(0,n.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/CharacterDialogExcelTable.json")).then(e=>e.json());i.push(...a)}},5961:function(e,t,a){a.d(t,{BJ:function(){return o},K$:function(){return l},j2:function(){return initialize},yB:function(){return s},zk:function(){return r}});var n=a(7480),i=a(2135),l=a(2102),r=a(2707),o=a(1382),s=a(2611);let c=[i,l,r,o,s],initialize=async e=>{let t="";switch(e){case"jp":t="".concat(e);break;case"en":t="".concat(e,"/Preload")}await new Promise(e=>{(0,n.q)(async()=>{for(let e of c)0===e.data.length&&await e.initialize(t);e(1)})})}},1382:function(e,t,a){a.r(t),a.d(t,{data:function(){return i},initialize:function(){return initialize}});var n=a(6667);let i=[],initialize=async e=>{let t=(0,n.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/LocalizeCharProfileExcelTable.json")).then(e=>e.json());i.push(...a)}},2611:function(e,t,a){a.r(t),a.d(t,{data:function(){return i},initialize:function(){return initialize}});var n=a(6667);let i=[],initialize=async e=>{let t=(0,n.X)(),a=await fetch("".concat(t,"/data/").concat(e,"/TableBundles/Excel/MemoryLobbyExcelTable.json")).then(e=>e.json());i.push(...a)}},7480:function(e,t,a){a.d(t,{q:function(){return runOnClient}});let runOnClient=e=>{"loading"==window.document.readyState?window.addEventListener("load",e):e()}}}]);